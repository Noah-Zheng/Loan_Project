---
title: "Loan_Project"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


# Loan Project 

## Background Information 
The dataset is from Prosper, an American company in the peer-to-peer lending industry. Prosper maintains a full public database of all loans issued through its marketplace on its website. This database and all market statistics can be accessed and queried for analysis of loan performance over time. 

## Source 
1. https://en.wikipedia.org/wiki/Prosper_Marketplace#cite_note-Prosper_Marketplace,_Inc-6 
2. https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0 
3. https://www.wikihow.com/Invest-on-Prosper.com

## Question
It is so hard to ask a good question. 
As a defensive investor, I would like to know the relationship between the Prosper rating and yield which should be nagative.  

The income of the borrower is not reliable as borrowers would likely to overstate their income in order to get a loan. Therefore, the following factors are choosen.  

6 Term
7 LoanStatus
11 LeanderYield
15 ProsperRating(numeric)
65 LoanOriginalAmount 



```{r import the data}
dd <- read.csv("prosperLoanData.csv")
```


```{r}
#Select columns
col_index <- c(6,7,11,15,65)
col_index <- col_index - 1
dd_s <- dd[, col_index]

names(dd_s)

#change column name "ProsperRating(numeric)" to "ProsperRating"
colnames(dd_s)[4] = "ProsperRating"

#select data after 2009
dd_s <- subset(dd_s, !is.na(ProsperRating))
```

```{r echo=FALSE, message=False, warning=FALSE, structure of the data}
str(dd_s)
summary(dd_s)
```

```{r echo=FALSE, message=False, warning=FALSE, univariate plot}
#ggpair
library(ggplot2)
library(GGally)
ggpairs(dd_s)
ggsave("univariateplot.png")

```

1. It seems there is no relationship between the yield and loan term.
2. There is a strong negative relationship between ProsperRating and LenderYield.
3. There is negative relationship between the loan amount and yield.
4. Loan amount and rating has positive relationship.

```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(x = ProsperRating)) +
  geom_histogram()
```

The distribution of rating is close to a normal distribution.

```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(ProsperRating, LenderYield)) +
  geom_point(alpha = 1/50, position = position_jitter())
```

It can be noticed that the yield decreases when rating increases. Listings with 1 and 4 have noticiable yield differ from the majority.


```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(ProsperRating, LenderYield)) +
  geom_line(stat = "summary", fun.y = "mean")
```

A strong negative relationship between the average yield and rating exists. 

```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(ProsperRating, LenderYield)) +
  geom_line(aes(color = LoanStatus), stat = "summary", fun.y = mean)
```


```{r}
#combine all past dues in one level 
dd_s$Status <- dd_s$LoanStatus
#find out the index of the past due levels
levels(dd_s$Status)
levels(dd_s$Status)[7:12] <- "Past Due"
#check the result
levels(dd_s$Status)
```


```{r}
ggplot(dd_s, aes(ProsperRating, LenderYield)) +
  geom_line(aes(color = Status), stat = "summary", fun.y = mean)
```


```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(LoanOriginalAmount, LenderYield)) +
  geom_point(alpha = 1/50, position = position_jitter())+
  geom_line(stat = "summary", fun.y= "median", color = "orange") +
  geom_smooth(color = "red")
```

No pattern.


```{r echo=FALSE, message=False, warning=FALSE}
qplot(data=dd_s, LenderYield) +
  facet_wrap(~Status, scales="free")
```

There is a relative big number of listings with yield more than 0.3 in all the
loan status levels except current. 

```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(ProsperRating, LoanOriginalAmount)) +
  geom_point(alpha = 1/50, position = position_jitter())
```

Listings with high risk tends to have low amount that that with low risk. 

```{r echo=FALSE, message=False, warning=FALSE}
ggplot(dd_s, aes(ProsperRating, LoanOriginalAmount)) +
  geom_line(stat = "summary", fun.y = "mean") +
  ylim(0,quantile(dd_s$LoanOriginalAmount, .99))
```

The average loan amount for listings with rating of 1 is around 3000, increasing to more than 10000 with rating 4. 


```{r}
ggplot(dd_s, aes(ProsperRating, LoanOriginalAmount)) +
  geom_line(aes(color = Status), stat = "summary", fun.y = "mean") +
  ylim(0,quantile(dd_s$LoanOriginalAmount, .99))
```

